
# ĞĞ²Ñ‚Ğ¾ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ FAB: Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ

## ĞĞ±Ğ·Ğ¾Ñ€ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸

Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ° Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾Ğ¹ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸ ÑĞºÑ€Ğ°Ğ½Ğ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ğ¿Ğ»Ğ°Ğ²Ğ°ÑÑ‰ĞµĞ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ñ‡Ğ°Ñ‚Ğ° (FAB), Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ Ğ² Ñ‡Ğ°Ñ‚ Ğ²Ğ¼ĞµÑÑ‚Ğµ Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼ "ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸ ÑÑ‚Ğ¾Ñ‚ ÑĞºÑ€Ğ¸Ğ½ Ğ¸ Ñ‡Ñ‚Ğ¾ Ğ½Ğ° Ğ½Ñ‘Ğ¼ Ğ²Ğ°Ğ¶Ğ½Ğ¾?".

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTO-SCREENSHOT FLOW                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  1. FAB Click                                                       â”‚
â”‚     â†“                                                               â”‚
â”‚  2. Check settings.autoScreenshot                                   â”‚
â”‚     â†“ (if enabled)                                                  â”‚
â”‚  3. Capture visible area (html2canvas)                              â”‚
â”‚     - Exclude FAB button itself                                     â”‚
â”‚     - Apply privacy blur to .blur-private elements                  â”‚
â”‚     â†“                                                               â”‚
â”‚  4. Compress to PNG â‰¤2MB                                            â”‚
â”‚     â†“                                                               â”‚
â”‚  5. Open Sheet with Chat iframe                                     â”‚
â”‚     â†“                                                               â”‚
â”‚  6. postMessage to iframe: { type: 'AUTO_SCREENSHOT', data }        â”‚
â”‚     â†“                                                               â”‚
â”‚  7. ChatPage receives message                                       â”‚
â”‚     - Shows preview with Cancel option                              â”‚
â”‚     - Auto-fills prompt: "ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸ ÑÑ‚Ğ¾Ñ‚ ÑĞºÑ€Ğ¸Ğ½..."                   â”‚
â”‚     â†“                                                               â”‚
â”‚  8. User confirms or edits â†’ Send                                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸

**ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°ĞºĞµÑ‚:**
- `html2canvas` (MIT License, ~40KB gzipped) - Ğ´Ğ»Ñ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ° DOM ĞºĞ°Ğº canvas

---

## Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ/Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ

| Ğ¤Ğ°Ğ¹Ğ» | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|----------|
| `src/lib/screenshotService.ts` | CREATE | Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ° Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ¾Ğ² |
| `src/hooks/useAutoScreenshot.ts` | CREATE | Hook Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ²Ñ‚Ğ¾ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ¾Ğ¼ |
| `src/components/FloatingChatButton.tsx` | MODIFY | Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ |
| `src/pages/ChatPage.tsx` | MODIFY | ĞŸÑ€Ğ¸ĞµĞ¼ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· postMessage |
| `src/lib/aiConfig.ts` | MODIFY | Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ autoScreenshot |
| `src/components/AISettingsCard.tsx` | MODIFY | UI toggle Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ° |
| `src/lib/i18n.tsx` | MODIFY | Ğ›Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑÑ‚Ñ€Ğ¾Ğº |
| `src/components/chat/AutoScreenshotPreview.tsx` | CREATE | ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ¿Ñ€ĞµĞ²ÑŒÑ Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¾Ğ¹ |

---

## Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### 1. Screenshot Service (`src/lib/screenshotService.ts`)

```typescript
interface ScreenshotOptions {
  excludeSelectors?: string[];  // Elements to exclude (e.g., FAB)
  blurSelectors?: string[];     // Elements to blur for privacy
  maxSize?: number;             // Max file size in bytes (default 2MB)
  quality?: number;             // PNG quality 0-1
}

interface ScreenshotResult {
  success: true;
  blob: Blob;
  base64DataUrl: string;
  dimensions: { width: number; height: number };
  capturedAt: number;
} | {
  success: false;
  error: 'capture_failed' | 'too_large' | 'permission_denied';
  message: string;
}

async function captureVisibleArea(options?: ScreenshotOptions): Promise<ScreenshotResult>
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ°ÑĞ¿ĞµĞºÑ‚Ñ‹:**
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `html2canvas` Ñ Ğ¾Ğ¿Ñ†Ğ¸ĞµĞ¹ `ignoreElements` Ğ´Ğ»Ñ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ FAB
- ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ CSS `filter: blur(10px)` Ğº ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼ Ñ ĞºĞ»Ğ°ÑÑĞ¾Ğ¼ `.blur-private` Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ¾Ğ¼
- ĞšĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ Ñ‡ĞµÑ€ĞµĞ· canvas Ñ ÑƒĞ¼ĞµĞ½ÑŒÑˆĞµĞ½Ğ¸ĞµĞ¼ dimensions ĞµÑĞ»Ğ¸ > 2MB
- ĞĞµ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ (privacy)

### 2. PostMessage Protocol

**ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° (FAB â†’ iframe):**
```typescript
interface AutoScreenshotMessage {
  type: 'AUTO_SCREENSHOT';
  payload: {
    base64DataUrl: string;
    timestamp: number;
    prompt: string;  // ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚
    route: string;   // ĞÑ‚ĞºÑƒĞ´Ğ° Ğ±Ñ‹Ğ» ÑĞ´ĞµĞ»Ğ°Ğ½ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚
  };
}

// Ğ’ FloatingChatButton Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ°:
iframeRef.current?.contentWindow?.postMessage({
  type: 'AUTO_SCREENSHOT',
  payload: { ... }
}, window.location.origin);
```

**ĞŸÑ€Ğ¸ĞµĞ¼ (ChatPage):**
```typescript
useEffect(() => {
  const handleMessage = (event: MessageEvent) => {
    if (event.origin !== window.location.origin) return;
    if (event.data.type === 'AUTO_SCREENSHOT') {
      setPendingAutoScreenshot(event.data.payload);
    }
  };
  window.addEventListener('message', handleMessage);
  return () => window.removeEventListener('message', handleMessage);
}, []);
```

### 3. Settings Extension (`aiConfig.ts`)

```typescript
interface AISettings {
  // ... existing fields
  autoScreenshot: boolean;           // Auto-capture on FAB open (default: false)
  autoScreenshotBlurPrivate: boolean; // Blur .blur-private elements (default: true)
  autoScreenshotAutoSend: boolean;    // Send without confirmation (default: false)
}
```

### 4. UI Flow Ğ² ChatPage

**Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ:**
1. **Pending**: Ğ¡ĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½, Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½ preview Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ" / "ĞÑ‚Ğ¼ĞµĞ½Ğ°" / "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚"
2. **Editing**: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚ĞµĞºÑÑ‚ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°
3. **Sending**: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ² Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ
4. **Dismissed**: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ»

**Preview Component:**
```tsx
<AutoScreenshotPreview
  imageUrl={pendingScreenshot.base64DataUrl}
  defaultPrompt={pendingScreenshot.prompt}
  onSend={(prompt) => handleSendWithScreenshot(prompt)}
  onDismiss={() => setPendingAutoScreenshot(null)}
  isLoading={isLoading}
/>
```

### 5. Privacy Considerations

**Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ blur:**
- ĞŸĞ¾Ğ»Ñ Ñ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸ (`input[type="password"]`)
- Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ñ ĞºĞ»Ğ°ÑÑĞ¾Ğ¼ `.blur-private` (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
- PIN-Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¸

**Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾: timestamp, route, dimensions, success/error
- ĞĞ• Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ: ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ, base64 data

**Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:**
- Ğ¡ĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ (base64 Ğ² state)
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸:
  - Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Sheet
  - Dismiss Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼
  - Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ
  - Ğ§ĞµÑ€ĞµĞ· 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ timeout (ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½)

---

## API / Endpoints

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ endpoint:**
`ai-chat` Edge Function ÑƒĞ¶Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ multimodal messages Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸.

**Payload (Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ Ñ‡Ñ‚Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ):**
```json
{
  "messages": [
    {
      "role": "user",
      "content": [
        { "type": "text", "text": "ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸ ÑÑ‚Ğ¾Ñ‚ ÑĞºÑ€Ğ¸Ğ½ Ğ¸ Ñ‡Ñ‚Ğ¾ Ğ½Ğ° Ğ½Ñ‘Ğ¼ Ğ²Ğ°Ğ¶Ğ½Ğ¾?" },
        { "type": "image_url", "image_url": { "url": "data:image/png;base64,..." } }
      ]
    }
  ],
  "profile": "balanced"
}
```

---

## ĞÑ†ĞµĞ½ĞºĞ° ÑÑ€Ğ¾ĞºĞ¾Ğ²

| Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | ĞÑ†ĞµĞ½ĞºĞ° | ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ |
|--------|--------|-----------|
| Screenshot Service + html2canvas | 2-3 Ñ‡Ğ°ÑĞ° | P0 |
| PostMessage communication | 1-2 Ñ‡Ğ°ÑĞ° | P0 |
| AutoScreenshotPreview component | 1-2 Ñ‡Ğ°ÑĞ° | P0 |
| Settings toggle + i18n | 0.5 Ñ‡Ğ°ÑĞ° | P1 |
| Privacy blur implementation | 1 Ñ‡Ğ°Ñ | P1 |
| E2E Ñ‚ĞµÑÑ‚Ñ‹ (mobile/desktop) | 2-3 Ñ‡Ğ°ÑĞ° | P2 |
| Timeout cleanup logic | 0.5 Ñ‡Ğ°ÑĞ° | P2 |
| **Ğ˜Ñ‚Ğ¾Ğ³Ğ¾** | **8-12 Ñ‡Ğ°ÑĞ¾Ğ²** | |

---

## ĞÑ†ĞµĞ½ĞºĞ° Ñ€Ğ¸ÑĞºĞ¾Ğ²

### Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº

| Ğ Ğ¸ÑĞº | Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ | Ğ’Ğ»Ğ¸ÑĞ½Ğ¸Ğµ | ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ |
|------|-------------|---------|-----------|
| **ĞšĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ**: ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹/PIN | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ | Default blur Ğ´Ğ»Ñ input[type=password], ÑĞ²Ğ½Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ .blur-private |
| **ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ**: html2canvas Ğ½Ğ° ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ñ… | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ loading indicator, timeout 5s, fallback "Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ" |

### Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ¸ÑĞº

| Ğ Ğ¸ÑĞº | Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ | Ğ’Ğ»Ğ¸ÑĞ½Ğ¸Ğµ | ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ |
|------|-------------|---------|-----------|
| **Cross-origin iframe**: postMessage Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° | ĞĞ¸Ğ·ĞºĞ°Ñ | Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ | ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° origin, fallback URL params |
| **Mobile performance**: Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚ Ğ½Ğ° ÑĞ»Ğ°Ğ±Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ñ… | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ÑŒ scale Ğ´Ğ»Ñ mobile (0.5x) |
| **Ğ Ğ°Ğ·Ğ¼ĞµÑ€ bundle**: html2canvas ~40KB | ĞĞ¸Ğ·ĞºĞ°Ñ | ĞĞ¸Ğ·ĞºĞ¾Ğµ | Lazy load Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾Ğ¿Ñ†Ğ¸Ğ¸ |

### ĞĞ¸Ğ·ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº

| Ğ Ğ¸ÑĞº | Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ | Ğ’Ğ»Ğ¸ÑĞ½Ğ¸Ğµ | ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ |
|------|-------------|---------|-----------|
| **ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚**: Ğ½ĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ | ĞĞ¸Ğ·ĞºĞ°Ñ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | Ğ¯Ğ²Ğ½Ğ¾Ğµ opt-in Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ…, Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ· Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ tooltip |

---

## UX Flow

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞŸĞ•Ğ Ğ’ĞĞ• Ğ’ĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ•                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ â†’ AI â†’ ĞĞ²Ñ‚Ğ¾ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ [OFF by default]                    â”‚
â”‚                                                                    â”‚
â”‚  ĞŸÑ€Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ tooltip:                                   â”‚
â”‚  "ĞŸÑ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ñ‡Ğ°Ñ‚Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‡ĞµĞ½ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚          â”‚
â”‚   Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞºÑ€Ğ°Ğ½Ğ° Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°. ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ Ñ€Ğ°Ğ·Ğ¼Ñ‹Ñ‚Ñ‹."          â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RUNTIME FLOW                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  1. ĞšĞ»Ğ¸Ğº Ğ½Ğ° FAB                                                    â”‚
â”‚     â†“                                                              â”‚
â”‚  2. [0.3-1s] ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ overlay "Ğ—Ğ°Ñ…Ğ²Ğ°Ñ‚ ÑĞºÑ€Ğ°Ğ½Ğ°..."                   â”‚
â”‚     â†“                                                              â”‚
â”‚  3. ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Sheet Ñ ChatPage                                       â”‚
â”‚     â†“                                                              â”‚
â”‚  4. Ğ’ ChatPage Ğ¿Ğ¾ÑĞ²Ğ»ÑĞµÑ‚ÑÑ preview:                                 â”‚
â”‚                                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚  [Screenshot preview]                   â”‚                    â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                    â”‚
â”‚     â”‚  â”‚ ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸ ÑÑ‚Ğ¾Ñ‚ ÑĞºÑ€Ğ¸Ğ½ Ğ¸ Ñ‡Ñ‚Ğ¾ Ğ½Ğ° Ğ½Ñ‘Ğ¼    â”‚â”‚                    â”‚
â”‚     â”‚  â”‚ Ğ²Ğ°Ğ¶Ğ½Ğ¾?                              â”‚â”‚                    â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                    â”‚
â”‚     â”‚  [ĞÑ‚Ğ¼ĞµĞ½Ğ°]  [Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ]  [ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ] â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                    â”‚
â”‚  5. ĞšĞ»Ğ¸Ğº "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ" â†’ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ chat flow                       â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (i18n)

```typescript
autoScreenshot: {
  title: language === 'ru' ? 'ĞĞ²Ñ‚Ğ¾ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚' : 'Auto-screenshot',
  description: language === 'ru' 
    ? 'ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑĞºÑ€Ğ°Ğ½ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ñ‡Ğ°Ñ‚Ğ°' 
    : 'Automatically capture screen when opening chat',
  capturing: language === 'ru' ? 'Ğ—Ğ°Ñ…Ğ²Ğ°Ñ‚ ÑĞºÑ€Ğ°Ğ½Ğ°...' : 'Capturing screen...',
  preview: language === 'ru' ? 'ĞŸÑ€ĞµĞ²ÑŒÑ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ°' : 'Screenshot preview',
  defaultPrompt: language === 'ru' 
    ? 'ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸ ÑÑ‚Ğ¾Ñ‚ ÑĞºÑ€Ğ¸Ğ½ Ğ¸ Ñ‡Ñ‚Ğ¾ Ğ½Ğ° Ğ½Ñ‘Ğ¼ Ğ²Ğ°Ğ¶Ğ½Ğ¾?' 
    : 'Look at this screen and what\'s important on it?',
  send: language === 'ru' ? 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ' : 'Send',
  dismiss: language === 'ru' ? 'ĞÑ‚Ğ¼ĞµĞ½Ğ°' : 'Cancel',
  edit: language === 'ru' ? 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ' : 'Edit',
  failed: language === 'ru' ? 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ¸Ñ‚ÑŒ ÑĞºÑ€Ğ°Ğ½' : 'Failed to capture screen',
  blurPrivate: language === 'ru' ? 'Ğ Ğ°Ğ·Ğ¼Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ' : 'Blur private fields',
}
```

---

## Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸

### E2E Ñ‚ĞµÑÑ‚Ñ‹

1. **Desktop Chrome**: ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ /calendar â†’ FAB â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ
2. **Mobile Safari**: ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ / â†’ FAB â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ â‰¤2MB
3. **Private fields**: ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Settings â†’ ÑƒĞ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ PIN-Ğ¿Ğ¾Ğ»Ğµ Ñ€Ğ°Ğ·Ğ¼Ñ‹Ñ‚Ğ¾
4. **Cancel flow**: FAB â†’ Preview â†’ ĞÑ‚Ğ¼ĞµĞ½Ğ° â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ state Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½
5. **Edit prompt**: FAB â†’ Preview â†’ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ â†’ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚ â†’ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ
6. **Timeout cleanup**: FAB â†’ Preview â†’ Ğ¶Ğ´Ğ°Ñ‚ÑŒ 5 Ğ¼Ğ¸Ğ½ â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ auto-dismiss
7. **Disabled setting**: Ğ’Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ² Settings â†’ FAB â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ½ĞµÑ‚ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ°

### Performance Ñ‚ĞµÑÑ‚Ñ‹

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Target | ĞœĞµÑ‚Ğ¾Ğ´ Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ |
|---------|--------|-----------------|
| Ğ’Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ° (desktop) | <1s | Performance.now() |
| Ğ’Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ° (mobile) | <2s | Performance.now() |
| Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ° | â‰¤2MB | blob.size |
| Memory leak | 0 | Chrome DevTools |

---

## ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½ĞµÑ€Ğ°

1. **Preview overlay**: ĞŸĞ¾Ğ»ÑƒĞ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½ Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ°Ñ‚ÑÑ€Ğ¾Ğ¹ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ° (max-height: 200px)
2. **Actions**: Ğ¢Ñ€Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ inline - "ĞÑ‚Ğ¼ĞµĞ½Ğ°" (ghost), "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ" (outline), "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ" (primary)
3. **Loading state**: Skeleton + spinner overlay Ğ½Ğ° FAB Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ°
4. **Error state**: Toast Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹, fallback Ğº Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ¼Ñƒ Ñ‡Ğ°Ñ‚Ñƒ Ğ±ĞµĞ· ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ğ°
5. **Privacy indicator**: ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹ badge "ğŸ”’" Ğ½Ğ° Ñ€Ğ°Ğ·Ğ¼Ñ‹Ñ‚Ñ‹Ñ… Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑÑ… Ğ² preview

