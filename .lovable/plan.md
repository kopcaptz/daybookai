

# –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω—ã–π Mood-–¢—Ä–µ–∫–∏–Ω–≥ + –¢–µ—Ö–Ω–æ-–ú–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –°—Ç–∏–ª—å –•—Ä–æ–Ω–∏–∫–∏

## –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**Mood Selector:**
- –°—Ç–∞—Ç–∏—á–Ω—ã–π —Å–ª–∞–π–¥–µ—Ä –≤ `NewEntry.tsx` (—Å—Ç—Ä–æ–∫–∞ 600)
- Default value: `mood = 3` (–†–æ–≤–Ω–æ/Steady)
- –ù–∏–∫–∞–∫–æ–π —Å–≤—è–∑–∏ —Å —Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

**AI Infrastructure:**
- Edge Functions: `ai-chat`, `ai-biography`, `ai-whisper`
- –ü—Ä–æ—Ñ–∏–ª–∏: `economy` ‚Üí `quality` (gemini-2.5-flash-lite ‚Üí gemini-2.5-pro)
- Discussions —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `mode` –∏ `contextText` ‚Äî –º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å "—Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã"

**Biography (21:00 Chronicles):**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `extractThemes()` –ª–æ–∫–∞–ª—å–Ω–æ + AI –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –§–æ—Ä–º–∞—Ç: `title`, `narrative`, `highlights`, `timeline`
- –°—Ç–∏–ª—å: –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π/–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π

---

## –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

### 1. –ü–æ—Ä–æ–≥ —Ç–æ—á–Ω–æ—Å—Ç–∏: –ñ–∏–≤–æ–π —Å–ª–∞–π–¥–µ—Ä vs. –§–∏–∫—Å–∞—Ü–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ñ–∏–≤–æ–π —Å–ª–∞–π–¥–µ—Ä —Å "—è–∫–æ—Ä–µ–º"**

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü–û–í–ï–î–ï–ù–ò–ï –°–õ–ê–ô–î–ï–†–ê                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ  –ù–∞—á–∞–ª–æ –≤–≤–æ–¥–∞:                                      ‚îÇ
‚îÇ    mood = inheritedMood || 3 (–¥–µ—Ñ–æ–ª—Ç)               ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –ö–∞–∂–¥—ã–µ 500ms (debounced):                          ‚îÇ
‚îÇ    ‚Üí –õ–æ–∫–∞–ª—å–Ω—ã–π sentiment analysis                   ‚îÇ
‚îÇ    ‚Üí suggestedMood = analyzeSentiment(text)         ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  UI:                                                ‚îÇ
‚îÇ    [üò¢] [üòî] [üòê] [üôÇ] [üòä]                          ‚îÇ
‚îÇ              ‚Üë               ‚Üë                      ‚îÇ
‚îÇ         current           suggestion               ‚îÇ
‚îÇ                           (ghost dot)              ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –ï—Å–ª–∏ —é–∑–µ—Ä —Å–∞–º –¥–≤–∏–≥–∞–µ—Ç —Å–ª–∞–π–¥–µ—Ä:                     ‚îÇ
‚îÇ    ‚Üí userOverride = true                            ‚îÇ
‚îÇ    ‚Üí –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ-–ø–æ–¥—Å–∫–∞–∑–∫–∏                   ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–æ—á–µ–º—É –∂–∏–≤–æ–π:**
- –ù–µ —Ñ—Ä—É—Å—Ç—Ä–∏—Ä—É–µ—Ç, –µ—Å–ª–∏ AI "–æ—à–∏–±—Å—è"
- –î–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ "—É–º–Ω–æ–≥–æ" –ø–æ–º–æ—â–Ω–∏–∫–∞
- Ghost-dot –∫–∞–∫ –ø–æ–¥—Å–∫–∞–∑–∫–∞, –Ω–µ –∫–∞–∫ –ø—Ä–∏–Ω—É–∂–¥–µ–Ω–∏–µ

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏:**
- `suggestedMood` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ç–æ—á–∫–∞/–æ–±–≤–æ–¥–∫–∞
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ suggestion ‚Üí –∞–≤—Ç–æ–º–∞—Ç–æ–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
- `userOverride` —Ñ–ª–∞–≥ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–∞–ª—å–Ω–µ–π—à–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

---

### 2. –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞—Ç–∞: –†–∏—Å–∫ "—ç—Ö–∞"

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –£–º–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å decay**

```typescript
interface InheritedMoodContext {
  mood: number;         // 1-5
  timestamp: number;    // –ö–æ–≥–¥–∞ –±—ã–ª–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
  source: 'discussion' | 'entry' | 'default';
  confidence: 'low' | 'medium' | 'high';
}

function getInheritedMood(): InheritedMoodContext | null {
  const lastDiscussion = getLastDiscussionMood();
  const lastEntry = getLastEntryMood();
  
  // Decay: –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ > 4 —á–∞—Å–æ–≤, –Ω–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å
  const DECAY_MS = 4 * 60 * 60 * 1000;
  const now = Date.now();
  
  if (lastDiscussion && (now - lastDiscussion.timestamp) < DECAY_MS) {
    return lastDiscussion;
  }
  if (lastEntry && (now - lastEntry.timestamp) < DECAY_MS) {
    return lastEntry;
  }
  
  return null; // –ò—Å–ø–æ–ª—å–∑—É–µ–º default = 3
}
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç "—ç—Ö–∞ –ø–ª–æ—Ö–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è":**
1. **–í—Ä–µ–º–µ–Ω–Ω–æ–π decay** ‚Äî 4 —á–∞—Å–∞ –º–∞–∫—Å–∏–º—É–º
2. **Confidence indicator** ‚Äî –µ—Å–ª–∏ low, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ–π—Ç—Ä–∞–ª—å
3. **"–°–±—Ä–æ—Å–∏—Ç—å" –∫–Ω–æ–ø–∫–∞** ‚Äî –±—ã—Å—Ç—Ä—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∫ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º—É
4. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç** ‚Äî "–†–∞–Ω–µ–µ –≤—ã –±—ã–ª–∏ –≤ [mood]. –°–µ–π—á–∞—Å?" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ vs. AI-–∑–∞–ø—Ä–æ—Å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  SENTIMENT ANALYSIS PIPELINE                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ  Layer 1: –õ–û–ö–ê–õ–¨–ù–´–ô (–≤—Å–µ–≥–¥–∞)                        ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                      ‚îÇ
‚îÇ  ‚Ä¢ Keyword matching (—Å–ª–æ–≤–∞—Ä—å —ç–º–æ—Ü–∏–π RU/EN)          ‚îÇ
‚îÇ  ‚Ä¢ Emoji detection                                  ‚îÇ
‚îÇ  ‚Ä¢ Punctuation density (!!! vs ...)                 ‚îÇ
‚îÇ  ‚Ä¢ Latency: <5ms                                    ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  Layer 2: AI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏)          ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                      ‚îÇ
‚îÇ  ‚Ä¢ –ï—Å–ª–∏ AI enabled && confidence < 0.7              ‚îÇ
‚îÇ  ‚Ä¢ Micro-request –∫ gemini-2.5-flash-lite            ‚îÇ
‚îÇ  ‚Ä¢ Tool calling: { mood: 1-5, confidence: 0-1 }     ‚îÇ
‚îÇ  ‚Ä¢ Latency: ~200ms                                  ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  Layer 3: INHERIT (–¥–ª—è –ø—É—Å—Ç—ã—Ö –∑–∞–ø–∏—Å–µ–π)              ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                      ‚îÇ
‚îÇ  ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–∏–π Discussion mood                        ‚îÇ
‚îÇ  ‚Ä¢ –ò–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—è—è Entry –∑–∞ —Å–µ–≥–æ–¥–Ω—è                   ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–æ—á–µ–º—É –Ω–µ —Ç–æ–ª—å–∫–æ AI:**
- –û—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º –≤–∞–∂–µ–Ω –¥–ª—è PWA
- –ò–∑–±–µ–∂–∞—Ç—å rate-limits –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –≤–≤–æ–¥–µ
- AI —Ç–æ–ª—å–∫–æ –¥–ª—è "finalization" –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

**–ü–æ—á–µ–º—É –Ω–µ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π:**
- –†—É—Å—Å–∫–∏–π —è–∑—ã–∫ —Å–ª–æ–∂–µ–Ω –¥–ª—è keyword-matching
- AI –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞–µ—Ç –∏—Ä–æ–Ω–∏—é, –∫–æ–Ω—Ç–µ–∫—Å—Ç
- Flash-lite –¥–µ—à–µ–≤—ã–π –∏ –±—ã—Å—Ç—Ä—ã–π

---

## –¢–µ—Ö–Ω–æ-–º–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å –•—Ä–æ–Ω–∏–∫–∏

### –¢–µ–∫—É—â–∏–π —Å—Ç–∏–ª—å (—Å—É—Ö–æ–π):
```
"–°–µ–≥–æ–¥–Ω—è –±—ã–ª –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å. –£—Ç—Ä–æ–º —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º, 
–¥–Ω—ë–º –≤—Å—Ç—Ä–µ—á–∞ —Å –∫–æ–ª–ª–µ–≥–∞–º–∏. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ."
```

### –ù–æ–≤—ã–π —Å—Ç–∏–ª—å (20% —Ç–µ—Ö–Ω–æ-–º–∏—Å—Ç–∏–∫–∏):
```
"–ö–æ–Ω—Ç—É—Ä –¥–Ω—è —á—ë—Ç–∫–æ –ø—Ä–æ—Ä–∏—Å–æ–≤–∞–Ω: —É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ Chiller #2 
–∑–∞–ª–æ–∂–∏–ª–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, –ø–æ–ª—É–¥–µ–Ω–Ω—ã–π —Å–æ–≤–µ—Ç –∫–æ–ª–ª–µ–≥ ‚Äî —Å–∫—Ä–µ–ø–∏–ª. 
–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è: –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º 
—Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø—Ä–æ—Å–∞–¥–∫–æ–π —Ä–µ—Å—É—Ä—Å–∞ (Mood: Steady ‚Üí Low). 
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ü–µ—á–∞—Ç–∏: –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ç–¥—ã—Ö–∞."
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ system prompt:

```typescript
const BIOGRAPHY_STYLE_PROMPT = {
  ru: `–°–¢–ò–õ–¨ –í–´–í–û–î–ê:
–¢—ã ‚Äî –ü–µ—á–∞—Ç—å –î–Ω—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Cyber-Grimoire.
‚Ä¢ 80% ‚Äî —á—ë—Ç–∫–∏–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —è–∑—ã–∫
‚Ä¢ 20% ‚Äî —Ç–µ—Ö–Ω–æ-–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è

–î–û–ü–£–°–¢–ò–ú–´–ï –¢–ï–†–ú–ò–ù–´:
–∫–æ–Ω—Ç—É—Ä –¥–Ω—è, –ø–µ—á–∞—Ç—å, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è, –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞,
—Ä–µ—Å—É—Ä—Å (= —ç–Ω–µ—Ä–≥–∏—è), —Å–æ–≤–µ—Ç –ü–µ—á–∞—Ç–∏, –ø—Ä–æ—Ç–æ–∫–æ–ª, —Å–∏–≥–Ω–∞—Ç—É—Ä–∞,
—Ä–µ–∑–æ–Ω–∞–Ω—Å (= —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤), –∫–∞–Ω–∞–ª (= —Å–≤—è–∑—å)

–ó–ê–ü–†–ï–©–ï–ù–û:
–º–∞–≥–∏—è, –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è, —ç–∑–æ—Ç–µ—Ä–∏–∫–∞, –¥—É—Ö–∏, –∫–∞—Ä—Ç—ã —Ç–∞—Ä–æ, –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—è

–ü–†–ò–ú–ï–† HIGHLIGHTS:
‚ùå "–ë—ã–ª –Ω–∞ —Ä–∞–±–æ—Ç–µ, —É—Å—Ç–∞–ª"
‚úÖ "–°–µ—Å—Å–∏—è —Å Chiller #2 ‚Äî –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞. –°–æ–≤–µ—Ç –ü–µ—á–∞—Ç–∏: –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –æ—Ç–¥—ã—Ö–∞."`,

  en: `OUTPUT STYLE:
You are the Day Seal for the Cyber-Grimoire app.
‚Ä¢ 80% ‚Äî clear analytical language
‚Ä¢ 20% ‚Äî techno-mystical terminology

ALLOWED TERMS:
day contour, seal, correlation logged, calibration,
resource (= energy), Seal's advice, protocol, signature,
resonance (= pattern match), channel (= connection)

FORBIDDEN:
magic, spells, esoterica, spirits, tarot, astrology

EXAMPLE HIGHLIGHT:
‚ùå "Was at work, got tired"
‚úÖ "Chiller #2 session ‚Äî high load. Seal's advice: rest calibration."`
};
```

---

## –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: "–ë–∏–æ-—Å–µ–Ω—Å–æ—Ä" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

**–ù–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –µ—Å–ª–∏:**
1. –í—ã–Ω–µ—Å–µ–º –≤ Settings –∫–∞–∫ toggle
2. Default: OFF (opt-in)
3. –ù–∞–∑–≤–∞–Ω–∏–µ: "–ê–≤—Ç–æ-–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ" / "Mood Sensor"

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  SETTINGS ‚Üí AI ‚Üí ADVANCED                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ  üß† –ê–≤—Ç–æ-–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ                        [OFF]    ‚îÇ
‚îÇ     –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ —Ç–µ–∫—Å—Ç—É –∑–∞–ø–∏—Å–∏          ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îú‚îÄ –ñ–∏–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏                        [ON]     ‚îÇ
‚îÇ  ‚îÇ  –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –≤–≤–æ–¥–∞           ‚îÇ
‚îÇ  ‚îÇ                                                  ‚îÇ
‚îÇ  ‚îî‚îÄ –ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏–∑ —á–∞—Ç–∞                    [ON]     ‚îÇ
‚îÇ     –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–∑ –û–±—Å—É–∂–¥–µ–Ω–∏–π           ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PREDICTIVE MOOD SYSTEM                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                           ‚îÇ
‚îÇ  ‚îÇ NewEntry.tsx     ‚îÇ                                           ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ                                           ‚îÇ
‚îÇ  ‚îÇ  text ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫ usePredictiveMood(text, settings)     ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ           ‚îÇ                               ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ           ‚ñº                               ‚îÇ
‚îÇ  ‚îÇ  ‚îÇMoodSelector ‚îÇ‚óÑ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ { suggested, source, confidence }    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ             ‚îÇ ‚îÇ                                           ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ [üò¢][üòî][üòê]‚îÇ ‚îÇ                                           ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ   ‚Üë    ‚Üë    ‚îÇ ‚îÇ                                           ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ user  ghost ‚îÇ ‚îÇ                                           ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ                                           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                           ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ src/lib/sentimentService.ts                              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  analyzeSentimentLocal(text) ‚Üí { mood, confidence }      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  analyzeSentimentAI(text)    ‚Üí { mood, confidence }      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  getInheritedMood()          ‚Üí InheritedMoodContext      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ src/hooks/usePredictiveMood.ts                           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Debounced (500ms) local analysis                      ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Inherits from Discussion/Entry on mount               ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Respects userOverride                                 ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Respects settings.autoMood toggle                     ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

| –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| `src/lib/sentimentService.ts` | CREATE | –õ–æ–∫–∞–ª—å–Ω—ã–π sentiment + AI fallback |
| `src/hooks/usePredictiveMood.ts` | CREATE | Hook –¥–ª—è –ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–≥–æ mood |
| `src/components/MoodSelector.tsx` | MODIFY | –î–æ–±–∞–≤–∏—Ç—å ghost-suggestion UI |
| `src/pages/NewEntry.tsx` | MODIFY | –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å usePredictiveMood |
| `src/lib/aiConfig.ts` | MODIFY | –î–æ–±–∞–≤–∏—Ç—å autoMood –≤ AISettings |
| `src/pages/SettingsPage.tsx` | MODIFY | UI –¥–ª—è toggle "–ê–≤—Ç–æ-–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ" |
| `src/lib/i18n.tsx` | MODIFY | –ù–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ |
| `supabase/functions/ai-biography/index.ts` | MODIFY | –î–æ–±–∞–≤–∏—Ç—å techno-mystical style prompt |
| `src/lib/db.ts` | MODIFY | –§—É–Ω–∫—Ü–∏—è getLastDiscussionMood() |

---

## UI –∏–∑–º–µ–Ω–µ–Ω–∏—è MoodSelector

```tsx
interface MoodSelectorProps {
  value: number;
  onChange: (value: number) => void;
  suggestedMood?: number;           // NEW
  suggestionSource?: 'text' | 'discussion' | 'entry';  // NEW
  onSuggestionAccept?: () => void;  // NEW
}

// Visual: Ghost dot –ø–æ–¥ suggested mood button
<button className={cn(
  mood === value && 'active',
  suggestedMood === mood && value !== mood && 'suggested-ghost'
)}>
  {emoji}
  {suggestedMood === mood && value !== mood && (
    <span className="absolute -bottom-1 w-2 h-2 rounded-full 
                     bg-cyber-glow/50 animate-pulse" />
  )}
</button>
```

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–§–∞–∑–∞ 1: –õ–æ–∫–∞–ª—å–Ω—ã–π Sentiment** (–±—ã—Å—Ç—Ä–æ, –±–µ–∑ AI)
   - `sentimentService.ts` —Å keyword matching
   - `usePredictiveMood` hook
   - UI ghost-dot –≤ MoodSelector

2. **–§–∞–∑–∞ 2: –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
   - `getInheritedMood()` –∏–∑ Discussions
   - Decay logic (4 —á–∞—Å–∞)
   - Settings toggle

3. **–§–∞–∑–∞ 3: AI Enhancement** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - Micro-request –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
   - –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ confidence < 0.7

4. **–§–∞–∑–∞ 4: Techno-Mystical Chronicles**
   - –û–±–Ω–æ–≤–∏—Ç—å system prompt –≤ `ai-biography`
   - –î–æ–±–∞–≤–∏—Ç—å style toggle –≤ Settings (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## –ò—Ç–æ–≥

| –í–æ–ø—Ä–æ—Å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|--------------|
| –°–ª–∞–π–¥–µ—Ä | –ñ–∏–≤–æ–π + ghost-suggestion + userOverride |
| –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ | –° decay (4—á) + confidence check |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –õ–æ–∫–∞–ª—å–Ω—ã–π (–≤—Å–µ–≥–¥–∞) + AI (–ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏, –µ—Å–ª–∏ enabled) |
| –°—Ç–∏–ª—å —Ö—Ä–æ–Ω–∏–∫–∏ | 80/20 –∞–Ω–∞–ª–∏—Ç–∏–∫–∞/—Ç–µ—Ö–Ω–æ-–º–∏—Å—Ç–∏–∫–∞ –≤ prompt |
| –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ UI | –ù–µ—Ç ‚Äî toggle –≤ Settings, default OFF |

