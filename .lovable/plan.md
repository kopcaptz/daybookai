

# –ü–ª–∞–Ω MVP v1.0: Adult Levels, Consent, Boundaries –∏ Safety Controls

## –û–±–∑–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- FSM: LOBBY ‚Üí PICKER ‚Üí RESPONDER ‚Üí REFLECTION ‚Üí NEXT (—Å–º–µ–Ω–∞ —Ä–æ–ª–µ–π)
- –¢–∞–±–ª–∏—Ü—ã `ethereal_game_sessions` –∏ `ethereal_game_rounds`
- Edge Function `ethereal_games` —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–∏—Ç—É–∞—Ü–∏–π –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–µ–π
- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: GameLobby, PickerView, ResponderView, ReflectionView
- Broadcast —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `game_update`
- Boolean –ø–æ–ª–µ `adult_mode` (–Ω—É–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ `adult_level`)

**–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º:**
1. –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π 0-3 –≤–º–µ—Å—Ç–æ boolean `adult_mode`
2. Dual consent (–æ–±–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç) —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π downshift
3. Boundaries (—á–µ–∫–±–æ–∫—Å—ã) + –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤–º–µ—Å—Ç–µ —Å consent
4. 4 —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–º–ø—Ç–∞ —Å –∂—ë—Å—Ç–∫–∏–º–∏ –∑–∞–ø—Ä–µ—Ç–∞–º–∏
5. Safety controls (–ø–∞—É–∑–∞, —Å–º–µ–Ω–∏—Ç—å —Ç–µ–º—É, –ø–æ–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å)
6. Aftercare rating (üòä/üòê/üõë) –ø–æ—Å–ª–µ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏
7. Warmup —á–µ—Ä–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤ –ø–µ—Ä–≤–æ–º —Ä–∞—É–Ω–¥–µ

---

## –§–∞–∑–∞ 1: –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

### 1.1 SQL –º–∏–≥—Ä–∞—Ü–∏—è (–±–µ–∑–æ–ø–∞—Å–Ω–∞—è, —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º –¥–∞–Ω–Ω—ã—Ö)

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º adult_level —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º
ALTER TABLE public.ethereal_game_sessions 
  ADD COLUMN adult_level smallint NOT NULL DEFAULT 0
    CHECK (adult_level >= 0 AND adult_level <= 3);

-- –ü–µ—Ä–µ–Ω–æ—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ adult_mode
UPDATE public.ethereal_game_sessions
SET adult_level = CASE WHEN adult_mode = true THEN 1 ELSE 0 END;

-- Consent –ø–æ–ª—è
ALTER TABLE public.ethereal_game_sessions 
  ADD COLUMN consent_picker boolean NOT NULL DEFAULT false;
ALTER TABLE public.ethereal_game_sessions 
  ADD COLUMN consent_responder boolean NOT NULL DEFAULT false;

-- Boundaries (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON)
ALTER TABLE public.ethereal_game_sessions 
  ADD COLUMN boundaries jsonb DEFAULT '{}'::jsonb;

-- Card type –¥–ª—è —Ä–∞—É–Ω–¥–æ–≤
ALTER TABLE public.ethereal_game_rounds 
  ADD COLUMN card_type text DEFAULT 'abc' 
    CHECK (card_type IN ('abc', 'open'));

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –ø–æ –∫–æ–º–Ω–∞—Ç–µ
CREATE INDEX IF NOT EXISTS idx_game_sessions_room_status
ON public.ethereal_game_sessions (room_id, status);

-- –£–¥–∞–ª—è–µ–º adult_mode –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
ALTER TABLE public.ethereal_game_sessions DROP COLUMN adult_mode;
```

### 1.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ boundaries (–∫–æ–Ω—Ç—Ä–∞–∫—Ç)

```json
{
  "noHumiliation": true,
  "noPain": true,
  "noThirdParties": true,
  "noPastPartners": true,
  "romanceOnly": false,
  "v": 1
}
```

**–ü—Ä–∞–≤–∏–ª–æ:** `romanceOnly = true` ‚Üí clamp: `adult_level = min(adult_level, 1)` + —Å–±—Ä–æ—Å consent.

---

## –§–∞–∑–∞ 2: Edge Function ‚Äî Consent –∏ Safety Endpoints

### 2.1 –ù–æ–≤—ã–µ endpoints (3 must-have)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/session/:id/consent` | –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å + —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å boundaries |
| POST | `/session/:id/level` | –ò–∑–º–µ–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å (—Ç–æ–ª—å–∫–æ downshift) + reset consent |
| POST | `/session/:id/skip` | –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É (regenerate —Å–∏—Ç—É–∞—Ü–∏—é —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞) |

### 2.2 –õ–æ–≥–∏–∫–∞ consent

**–ü—Ä–∞–≤–∏–ª–∞:**
- **–ü–æ–≤—ã—Å–∏—Ç—å** `adult_level` ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –æ–±–æ—é–¥–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ
- **–ü–æ–Ω–∏–∑–∏—Ç—å** `adult_level` ‚Äî –ª—é–±–æ–π –∏–≥—Ä–æ–∫ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç (safety-first)
- –ï—Å–ª–∏ responder –Ω–∞–∂–∞–ª "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–Ω–∏–∑–∏—Ç—å" ‚Äî **—Å—Ä–∞–∑—É** –ø–æ–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç consent

**–°–±—Ä–æ—Å consent –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è:**
- –ï—Å–ª–∏ —Å—Ç–∞–ª–æ `0` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–æ–º `consent_picker = true`, `consent_responder = true` (level 0 –Ω–µ —Ç—Ä–µ–±—É–µ—Ç consent)
- –ï—Å–ª–∏ —Å—Ç–∞–ª–æ `> 0` ‚Üí `consent_picker = false`, `consent_responder = false` (–Ω—É–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–Ω–æ–≤–æ)

### 2.3 Endpoint `/session/:id/consent`

```text
POST /session/:id/consent
Body: { boundaries: {...}, level: 2 }

–õ–æ–≥–∏–∫–∞:
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–æ–ª—å –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ (picker/responder)
2. –ï—Å–ª–∏ boundaries.romanceOnly ‚Üí clamp level to max 1
3. –ó–∞–ø–∏—Å–∞—Ç—å consent_picker –∏–ª–∏ consent_responder = true
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å boundaries
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –µ—Å–ª–∏ –æ–±–∞ consent true –ò level > 0 ‚Üí –º–æ–∂–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å
6. –í–µ—Ä–Ω—É—Ç—å { needsConsent: !bothConsented, session }
```

### 2.4 Endpoint `/session/:id/level` (—Ç–æ–ª—å–∫–æ downshift)

```text
POST /session/:id/level
Body: { level: 1 }

–õ–æ–≥–∏–∫–∞:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: newLevel < currentLevel (–Ω–µ–ª—å–∑—è –ø–æ–≤—ã—à–∞—Ç—å –±–µ–∑ consent)
2. –û–±–Ω–æ–≤–∏—Ç—å adult_level
3. –ï—Å–ª–∏ newLevel > 0 ‚Üí —Å–±—Ä–æ—Å–∏—Ç—å consent_picker = false, consent_responder = false
4. –ï—Å–ª–∏ newLevel = 0 ‚Üí consent –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –æ–±–∞ = true
5. Broadcast game_update
```

### 2.5 Endpoint `/session/:id/skip`

```text
POST /session/:id/skip

–õ–æ–≥–∏–∫–∞:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞—É–Ω–¥
2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Å–∏—Ç—É–∞—Ü–∏—é —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
3. –û–±–Ω–æ–≤–∏—Ç—å situation_text, options –≤ —Ç–µ–∫—É—â–µ–º —Ä–∞—É–Ω–¥–µ
4. –°–±—Ä–æ—Å–∏—Ç—å responder_answer, responder_custom, picker_revealed, ai_reflection
5. Broadcast game_update
```

---

## –§–∞–∑–∞ 3: 4 —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–º–ø—Ç–∞ —Å –∂—ë—Å—Ç–∫–∏–º–∏ –∑–∞–ø—Ä–µ—Ç–∞–º–∏

### 3.1 –ü—Ä–æ–º–ø—Ç –ø–æ —É—Ä–æ–≤–Ω—è–º

```text
// Level 0 (SFW)
–†–µ–∂–∏–º: –õ—ë–≥–∫–∏–π / SFW
–§–æ–∫—É—Å: –ë—ã—Ç, —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –ø–ª–∞–Ω—ã, –ª—ë–≥–∫–∏–π —Ñ–ª–∏—Ä—Ç.
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –ù–∏–∫–∞–∫–∏—Ö –∏–Ω—Ç–∏–º–Ω—ã—Ö —Ç–µ–º.

// Level 1 (Romantic)
–†–µ–∂–∏–º: –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π
–§–æ–∫—É—Å: –ü–æ—Ü–µ–ª—É–∏, –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è, –Ω–µ–∂–Ω–æ—Å—Ç—å, –±–ª–∏–∑–æ—Å—Ç—å.
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –ë–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∏–Ω—Ç–∏–º–Ω–æ—Å—Ç–∏.

// Level 2 (Sensual)
–†–µ–∂–∏–º: –ß—É–≤—Å—Ç–≤–µ–Ω–Ω—ã–π
–§–æ–∫—É—Å: –¢–µ–ª–∞, –∂–µ–ª–∞–Ω–∏—è, –ø—Ä–µ–ª—é–¥–∏—è, —Å—Ü–µ–Ω–∞—Ä–∏–∏.
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –ë–µ–∑ explicit –æ–ø–∏—Å–∞–Ω–∏–π.

// Level 3 (Intimate)
–†–µ–∂–∏–º: –û—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–π
–§–æ–∫—É—Å: –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è, —Ñ–∞–Ω—Ç–∞–∑–∏–∏, –≥—Ä–∞–Ω–∏—Ü—ã, kink-light.
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –§–æ–∫—É—Å –Ω–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è—Ö, –ù–ï –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è—Ö.
```

### 3.2 –ñ—ë—Å—Ç–∫–∏–µ –∑–∞–ø—Ä–µ—Ç—ã (–¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–∂–¥—ã–π –ø—Ä–æ–º–ø—Ç level 1-3)

```text
–°–¢–†–û–ì–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
- –¢–æ–ª—å–∫–æ –≤–∑—Ä–æ—Å–ª—ã–µ (18+)
- –¢–æ–ª—å–∫–æ consensual —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –ó–ê–ü–†–ï–©–ï–ù–û: non-consent, coercion, minors/ageplay, incest, violence, 
  humiliation/degradation, bodily fluids (scat/watersports), hate/raceplay
- –¢–æ–Ω: –±–µ—Ä–µ–∂–Ω—ã–π, –±–µ–∑ –æ—Ü–µ–Ω–∫–∏, –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è
- –ù–ï –ø—Ä–æ—Å–∏—Ç—å —Å–µ–∫—Å—É–∞–ª—å–Ω—ã–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ ‚Äî —Ç–æ–ª—å–∫–æ "–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è" –∏ "—Å—Ü–µ–Ω–∞—Ä–∏–∏"
```

### 3.3 Boundaries –≤ –ø—Ä–æ–º–ø—Ç–µ

```text
// –î–æ–±–∞–≤–∏—Ç—å –≤ system prompt –µ—Å–ª–∏ –µ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
–û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
${boundaries.noHumiliation ? '- –ë–µ–∑ –≥—Ä—É–±–æ—Å—Ç–∏ –∏ —É–Ω–∏–∂–µ–Ω–∏—è\n' : ''}
${boundaries.noPain ? '- –ë–µ–∑ –±–æ–ª–∏\n' : ''}
${boundaries.noThirdParties ? '- –ë–µ–∑ —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü\n' : ''}
${boundaries.noPastPartners ? '- –ë–µ–∑ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –ø—Ä–æ—à–ª–æ–≥–æ –æ–ø—ã—Ç–∞\n' : ''}
${boundaries.romanceOnly ? '- –¢–æ–ª—å–∫–æ —Ä–æ–º–∞–Ω—Ç–∏–∫–∞ (—É—Ä–æ–≤–µ–Ω—å 1)\n' : ''}
```

### 3.4 Warmup (–ø–µ—Ä–≤—ã–π —Ä–∞—É–Ω–¥ level > 0)

```text
// –î–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–º–ø—Ç –µ—Å–ª–∏ round_number == 1 && adult_level > 0:
–≠—Ç–æ –ü–ï–†–í–´–ô —Ä–∞—É–Ω–¥ ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–π –ú–Ø–ì–ö–û, –∫–∞–∫ —Ä–∞–∑–º–∏–Ω–∫—É.
–î–æ–±–∞–≤—å –≤ valuesQuestion –≤–æ–ø—Ä–æ—Å –æ –∫–æ–º—Ñ–æ—Ä—Ç–µ:
"–ü–µ—Ä–µ–¥ —ç—Ç–∏–º: —á—Ç–æ —Ç–æ—á–Ω–æ –æ–∫/–Ω–µ –æ–∫ —Å–µ–≥–æ–¥–Ω—è?"
```

---

## –§–∞–∑–∞ 4: UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 4.1 AdultLevelSelector

| –£—Ä–æ–≤–µ–Ω—å | –ù–∞–∑–≤–∞–Ω–∏–µ | –ò–∫–æ–Ω–∫–∞ |
|---------|----------|--------|
| 0 | –õ—ë–≥–∫–∏–π | - |
| 1 | –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π | üî• |
| 2 | –ß—É–≤—Å—Ç–≤–µ–Ω–Ω—ã–π | üî•üî• |
| 3 | –û—Ç–∫—Ä–æ–≤–µ–Ω–Ω—ã–π | üî•üî•üî• |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –î–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º. –ü—Ä–∏ level > 0 –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.

### 4.2 ConsentModal

**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ GameLobby –∫–æ–≥–¥–∞ `adult_level > 0` –∏ –Ω–µ –æ–±–∞ consent.

**–î–ª—è Picker:**
- –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è (AdultLevelSelector)
- –ß–µ–∫–±–æ–∫—Å—ã boundaries
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –∂–¥–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–∞"

**–î–ª—è Responder:**
- –ë–∞–Ω–Ω–µ—Ä: "–ü–∞—Ä—Ç–Ω—ë—Ä –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å üî•üî•. –°–æ–≥–ª–∞—Å–Ω—ã?"
- –ß–µ–∫–±–æ–∫—Å—ã boundaries (—Å–≤–æ–∏)
- –ö–Ω–æ–ø–∫–∏: "–°–æ–≥–ª–∞—Å–µ–Ω", "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–Ω–∏–∑–∏—Ç—å (0/1/2)"

### 4.3 SafetyControls

**–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–≤–µ—Ä—Ö—É –∫–∞–∂–¥–æ–π SituationCard:**

| –ö–Ω–æ–ø–∫–∞ | –ò–∫–æ–Ω–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|--------|-----------|----------|
| –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É | ‚è≠ | 1 (–≥–ª–∞–≤–Ω–∞—è) | POST /skip |
| –ü–æ–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å | ‚ÜòÔ∏è | 2 | –ú–µ–Ω—é: –≤—ã–±–æ—Ä 0/1/2 |
| –ü–∞—É–∑–∞ | ‚è∏ | 3 | –°–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É, –ø–æ–∫–∞–∑–∞—Ç—å "–ú—ã –Ω–∞ –ø–∞—É–∑–µ" |

### 4.4 AftercareRating

**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –æ—Ç–≤–µ—Ç–∞ picker (–≤ ReflectionView):**

```text
"–ö–∞–∫ —Ç–µ–±–µ —ç—Ç–æ—Ç —Ä–∞—É–Ω–¥?"
[üòä –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ]  [üòê –æ—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ]  [üõë —Å—Ç–æ–ø]
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- üòä: –Ω–∏—á–µ–≥–æ, –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É
- üòê: –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–°–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å?"
- üõë: –∞–≤—Ç–æ `adult_level -= 1` (min 0), –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–º–µ–Ω–∏—Ç—å —Ç–µ–º—É

---

## –§–∞–∑–∞ 5: Broadcast –∏ Reconnect

### 5.1 –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π payload game_update

```json
{
  "sessionId": "...",
  "roundId": "...",
  "phase": "picker|responder|reflection",
  "session": {
    "status": "lobby|active|completed",
    "adult_level": 2,
    "consent_picker": true,
    "consent_responder": true
  },
  "updated_at": 1738500000000
}
```

**–ü—Ä–∞–≤–∏–ª–æ:** –ö–ª–∏–µ–Ω—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è —Å `updated_at` –º–µ–Ω—å—à–µ —Ç–µ–∫—É—â–µ–≥–æ.

### 5.2 Reconnect

–ü—Ä–∏ reconnect ‚Üí `GET /round/:sessionId` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (session + round + myRole).

---

## –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î** | –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è: adult_level, consent_*, boundaries, card_type, –∏–Ω–¥–µ–∫—Å |
| `supabase/functions/ethereal_games/index.ts` | –ù–æ–≤—ã–µ endpoints (consent, level, skip), 4 —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–º–ø—Ç–∞, boundaries –≤ –ø—Ä–æ–º–ø—Ç, warmup –ª–æ–≥–∏–∫–∞ |
| `src/lib/gameService.ts` | –ù–æ–≤—ã–µ API –º–µ—Ç–æ–¥—ã: setConsent, setLevel, skipSituation |
| `src/components/games/AdultLevelSelector.tsx` | **–ù–æ–≤—ã–π:** –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è 0-3 |
| `src/components/games/ConsentModal.tsx` | **–ù–æ–≤—ã–π:** –º–æ–¥–∞–ª–∫–∞ consent + boundaries |
| `src/components/games/SafetyControls.tsx` | **–ù–æ–≤—ã–π:** –ø–∞–Ω–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (skip, downshift, pause) |
| `src/components/games/AftercareRating.tsx` | **–ù–æ–≤—ã–π:** —Ä–µ–π—Ç–∏–Ω–≥ –∫–æ–º—Ñ–æ—Ä—Ç–∞ (üòä/üòê/üõë) |
| `src/components/games/GameLobby.tsx` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è AdultLevelSelector + ConsentModal, –ª–æ–≥–∏–∫–∞ consent check |
| `src/components/games/PickerView.tsx` | –î–æ–±–∞–≤–∏—Ç—å SafetyControls, warmup –ø–ª–∞—à–∫–∞ –≤ –ø–µ—Ä–≤–æ–º —Ä–∞—É–Ω–¥–µ |
| `src/components/games/ResponderView.tsx` | –î–æ–±–∞–≤–∏—Ç—å SafetyControls |
| `src/components/games/ReflectionView.tsx` | –î–æ–±–∞–≤–∏—Ç—å AftercareRating –ø–æ—Å–ª–µ reveal |
| `src/pages/ethereal/SituationsGame.tsx` | –õ–æ–≥–∏–∫–∞ consent check –ø–µ—Ä–µ–¥ –∏–≥—Ä–æ–π, –ø–µ—Ä–µ–¥–∞—á–∞ adult_level |

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1 (–∫—Ä–∏—Ç–∏—á–Ω–æ ‚Äî –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã)
1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (adult_level, consent_*, boundaries, card_type)
2. Edge Function: –æ–±–Ω–æ–≤–∏—Ç—å `/create` –∏ `/start` –¥–ª—è adult_level
3. Edge Function: endpoint `/session/:id/consent`
4. AdultLevelSelector –≤ GameLobby
5. ConsentModal —Å boundaries

### –≠—Ç–∞–ø 2 (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
6. Edge Function: endpoints `/session/:id/level` –∏ `/session/:id/skip`
7. SafetyControls –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
8. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SafetyControls –≤ PickerView –∏ ResponderView
9. 4 —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–º–ø—Ç–∞ —Å –∂—ë—Å—Ç–∫–∏–º–∏ –∑–∞–ø—Ä–µ—Ç–∞–º–∏

### –≠—Ç–∞–ø 3 (–∫–∞—á–µ—Å—Ç–≤–æ UX)
10. AftercareRating –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
11. Warmup –≤ –ø–µ—Ä–≤–æ–º —Ä–∞—É–Ω–¥–µ (–ø—Ä–æ–º–ø—Ç + –ø–ª–∞—à–∫–∞)
12. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π broadcast payload —Å updated_at

---

## –ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º

- [ ] DB –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–∞–Ω–∞ –Ω–∞ —á–∏—Å—Ç–æ–π –±–∞–∑–µ –∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å adult_mode)
- [ ] Downshift –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç consent
- [ ] Skip –Ω–µ –º–µ–Ω—è–µ—Ç —Ñ–∞–∑—É, —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é/–æ–ø—Ü–∏–∏ –≤ —Ç–µ–∫—É—â–µ–º —Ä–∞—É–Ω–¥–µ
- [ ] Consent modal –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ level > 0 –∏ –ø–æ–∫–∞ –Ω–µ –æ–±–∞ true
- [ ] romanceOnly –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –¥–æ 1
- [ ] –ñ—ë—Å—Ç–∫–∏–µ –∑–∞–ø—Ä–µ—Ç—ã –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö –¥–ª—è —É—Ä–æ–≤–Ω–µ–π 1-3

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç 90% –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø—Ä–æ—Å—Ç–æ–º FSM (5 —Ñ–∞–∑):
- –£—Ä–æ–≤–Ω–∏ –±–ª–∏–∑–æ—Å—Ç–∏ 0-3 –≤–º–µ—Å—Ç–æ boolean
- –î–≤–æ–π–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö —Ç–µ–º
- –õ—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç (safety-first)
- –ì—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ö–Ω–æ–ø–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ –∫–∞–∂–¥–æ–º —Ä–∞—É–Ω–¥–µ (skip –ø–µ—Ä–≤–∞—è!)
- –ë—ã—Å—Ç—Ä–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–æ–º—Ñ–æ—Ä—Ç–∞ –ø–æ—Å–ª–µ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏
- –ú—è–≥–∫–∏–π warmup –≤ –ø–µ—Ä–≤–æ–º —Ä–∞—É–Ω–¥–µ level > 0
- –ñ—ë—Å—Ç–∫–∏–µ –∑–∞–ø—Ä–µ—Ç—ã –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö –∏—Å–∫–ª—é—á–∞—é—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

